var SQLiteHelper=new Class({db:"",Implements:[Options,Fields],options:{dbName:"casi",dbDescription:"CASI Schema",size:2*1024*1024,tableName:"",db:"",},fields:{},jQuery:"SQLiteHelper",initialize:function(c,b){this.setOptions(c);this.setFields(b);if(this.options.db==""){this.options.db=openDatabase(this.options.dbName,"1.0",this.options.dbDescription,this.options.size)}},createTable:function(){var b=this;this.options.db.transaction(function(c){c.executeSql(b.getCreateTableStatement(),[],function(){console.log("create table done!")},function(d,e){console.log("create tale fail!!! "+e.message)})})},persist:function(e){var b;for(var h in e.fields){if(e.fields[h].isPrimaryKey===true){b=e.fields[h].name;break}}var c=this;var g=[];var f=this.findPrimaryKeyName();console.log(e.options[f]);g.push(e.options[f]);for(var h in e.options){if(!(f==h)){g.push(e.options[h])}}console.log(this.options.tableName);console.log(g);c.getDB().transaction(function(d){d.executeSql(c.getInsertStatement(),g,function(){console.log("insert success")},function(i,j){console.log("insert fail. "+j.message)})})},clear:function(){var b="DELETE FROM "+this.options.tableName;this.options.db.transaction(function(c){c.executeSql(b,[],function(){console.log("Removed all data succed")},function(d,e){console.log("Remove fail "+e.message)})})},update:function(c){var b=this;var f=[];var e=this.findPrimaryKeyName();for(var g in c.options){if(!(e==g)){f.push(c.options[g])}}f.push(this.getPrimaryKey(c));this.options.db.transaction(function(d){d.executeSql(b.getUpdateStatement(),f,function(){console.log("Update succed")},function(h,i){console.log("Update fail "+i.message)})})},remove:function(c){var b=this;this.options.db.transaction(function(d){d.executeSql(b.getUpdateStatement(),[c],function(){alert("Delete record succed")},function(e,f){alert("Update fail "+f.message)})})},getPrimaryKey:function(b){var c="";for(var d in this.fields){if(this.fields[d].isPrimaryKey===true){c=this.fields[d].name;break}}return b.options[c]},findPrimaryKeyName:function(){var b="";for(var c in this.fields){if(this.fields[c].isPrimaryKey===true&&this.fields[c].dataType==="INTEGER"){b=this.fields[c].name;break}}return b},getFindByPrimaryKeyStatement:function(c){var b="SELECT * FROM "+this.options.tableName+" WHERE "+this.findPrimaryKeyName()+" = "+c;console.log(b);return b},getCreateTableStatement:function(){var e="CREATE TABLE IF NOT EXISTS "+this.options.tableName;var b=" (";for(var d in this.fields){var c=this.fields[d];b=b+c.name+" "+c.dataType;if(c.isPrimaryKey===true){b+=" PRIMARY KEY";if(this.fields[d].dataType==="INTEGER"){b+=" AUTOINCREMENT"}}b+=", "}b=b.substring(0,b.length-2)+")";e+=b;return e},getSelectAllStatement:function(){var b="SELECT * FROM "+this.options.tableName;return b},getInsertStatement:function(){var e="INSERT INTO "+this.options.tableName;var b=" (",d=" VALUES (";for(var g in this.fields){var c=this.fields[g];b+=c.name+", ";d+="?, "}b=b.substring(0,b.length-2)+")";d=d.substring(0,d.length-2)+")";e+=b+d;console.log(e);return e},getUpdateStatement:function(){var c="";var b="UPDATE "+this.options.tableName+" SET ";var e="";for(var g in this.fields){var d=this.fields[g];if(d.isPrimaryKey===true){c=d.name}else{e+=d.name+" = ?, "}}e=e.substring(0,e.length-2);b+=e+" WHERE "+c+" = ?";return b},getDeleteStatement:function(){var b="DELETE FROM "+this.options.tableName+" WHERE id=?";return b},getDropStatement:function(){},dropTable:function(d){var b=this;var c="DROP TABLE IF EXISTS "+this.options.tableName;this.options.db.transaction(function(e){e.executeSql(c,[],function(){console.log("Drop table "+b.options.tableName+" complete");d()},function(f,g){console.log("Drop table "+b.options.tableName+" problem "+g.message)})})},getLastRecord:function(d){var b="SELECT * FROM "+this.options.tableName;var c;this.options.db.transaction(function(e){e.executeSql(b,[],function(g,f){dataset=f.rows;if(dataset.length>0){c=dataset.item(dataset.length-1);console.log(c.surveyId+"|"+c.surveyCode)}})});return c},remove:function(b){},queryAllQuestionaires:function(){},queryById:function(b){},queryByLatestSurvays:function(){},getDB:function(){return this.options.db}});var db=openDatabase("AddressBook","1.0","Address Book",200000);var createStatement="CREATE TABLE IF NOT EXISTS Contacts (id INTEGER PRIMARY KEY AUTOINCREMENT, firstName TEXT, lastName TEXT, phone TEXT)";var selectAllStatement="SELECT * FROM Contacts";var insertStatement="INSERT INTO Contacts (firstName, lastName, phone) VALUES (?, ?, ?)";var updateStatement="UPDATE Contacts SET firstName = ?, lastName = ?, phone = ? WHERE id = ?";var deleteStatement="DELETE FROM Contacts WHERE id=?";var dropStatement="DROP TABLE Contacts";var results=document.getElementById("results");var id=document.getElementById("id");var firstName=document.getElementById("firstName");var lastName=document.getElementById("lastName");var phone=document.getElementById("phone");function createTable(){db.transaction(function(b){b.executeSql(createStatement,[],showRecords,onError)})}function insertRecord(){db.transaction(function(b){b.executeSql(insertStatement,[firstName.value,lastName.value,phone.value],showRecords,onError)})}function loadRecord(b){var c=dataset.item(b);firstName.value=c.firstName;lastName.value=c.lastName;phone.value=c.phone;id.value=c.id}function updateRecord(){db.transaction(function(b){b.executeSql(updateStatement,[firstName.value,lastName.value,phone.value,id.value],showRecords,onError)})}function deleteRecord(b){db.transaction(function(c){c.executeSql(deleteStatement,[b],showRecords,onError)})}function dropTable(){db.transaction(function(b){b.executeSql(dropStatement,[],showRecords,onError)})}function onError(b,c){alert(c.message)}function showRecords(){results.innerHTML="";db.transaction(function(b){b.executeSql(selectAllStatement,[],function(d,c){dataset=c.rows;for(var e=0,f=null;e<dataset.length;e++){f=dataset.item(e);results.innerHTML+="<li>"+f.lastName+" , "+f.firstName+' <a href="#" onclick="loadRecord('+e+')">edit</a>  <a href="#" onclick="deleteRecord('+f.id+')">delete</a></li>'}})})}var Surveys=new Class({Implements:[Options,Fields],fields:{primaryKey:{name:"surveyId",dataType:"INTEGER",isPrimaryKey:true,},surveyCode:{name:"surveyCode",dataType:"TEXT",},description1:{name:"description1",dataType:"TEXT",},description2:{name:"description2",dataType:"TEXT"},status:{name:"status",dataType:"TEXT"},editedDate:{name:"editedDate",dataType:"NUMERIC"}},options:{surveyId:"",surveyCode:"",description1:"",description2:"",status:"",editedDate:"",},jQuery:"Surveys",initialize:function(b){},setSurveyId:function(b){this.options.surveyId=b},setSurveyCode:function(b){this.options.surveyCode=b},setDescription1:function(b){this.options.description1=b},setDescription2:function(b){this.options.description2=b},setStatus:function(b){this.options.status=b},setEditedDate:function(b){this.options.editedDate=b},getEditedDate:function(){return this.options.editedDate},getStatus:function(){return this.options.status},getSurveyId:function(){return this.options.surveyId},getSurveyCode:function(){return this.options.surveyCode},getDescription1:function(){return this.options.description1},getDescriptio2:function(){return this.options.description2}});var Section=new Class({Implements:[Options,Fields],fields:{primaryKey:{name:"sectionId",dataType:"INTEGER",isPrimaryKey:true,},surveyId:{name:"surveyId",dataType:"INTEGER",},sectionCode:{name:"sectionCode",dataType:"TEXT",},description1:{name:"description1",dataType:"TEXT"},description2:{name:"description2",dataType:"TEXT"}},options:{sectionId:"",surveyId:"",sectionCode:"",description1:"",description2:""},jQuery:"Section",initialize:function(b){},getPrimaryKey:function(){return this.fields.primaryKey},setSectionId:function(b){this.options.sectionId=b},setSurveyId:function(b){this.options.surveyId=b},setSectionCode:function(b){this.options.sectionCode=b},setDescription1:function(b){this.options.description1=b},setDescription2:function(b){this.options.description2=b},getSectionId:function(){return this.options.sectionId},getSectionCode:function(){return this.options.sectionCode},getDescription1:function(){return this.options.description1},getDescription2:function(){return this.options.description2}});var Question=new Class({Implements:[Options,Fields],fields:{primaryKey:{name:"questionId",dataType:"INTEGER",isPrimaryKey:true,},sectionId:{name:"sectionId",dataType:"INTEGER",},questionCode:{name:"questionCode",dataType:"TEXT",},allowNull:{name:"allowNull",dataType:"NUMERIC",},description1:{name:"description1",dataType:"TEXT"},description2:{name:"description2",dataType:"TEXT"},parentId:{name:"parentId",dataType:"INTEGER",},questionTypeId:{name:"questionTypeId",dataType:"INTEGER"},enableOther:{name:"enableOther",dataType:"NUMERIC",},numberRange:{name:"numberRange",dataType:"TEXT"},dateRange:{name:"dateRange",dataType:"TEXT"},image:{name:"image",dataType:"BLOB"}},options:{questionId:"",sectionId:"",questionCode:"",allowNull:"",description1:"",description2:"",parentId:"",questionTypeId:"",enableOther:"",numberRange:"",dateRange:"",image:""},jQuery:"Question",initialize:function(b){},setImage:function(b){this.options.image=b},getImage:function(){return this.options.image},setQuestionId:function(b){this.options.questionId=b},setSectionId:function(b){this.options.sectionId=b},setQuestionCode:function(b){this.options.questionCode=b},setDescription1:function(b){this.options.description1=b},setDescription2:function(b){this.options.description2=b},setParentId:function(b){this.options.parentId=b},setQuestionTypeId:function(b){this.options.questionTypeId=b},setEnableOther:function(b){this.options.enableOther=b},setNumberRange:function(b){this.options.numberRange=b},setDateRange:function(b){this.options.dateRange=b},setAllowNull:function(b){this.options.allowNull=b},getAllowNull:function(){return this.options.allowNull},getQuestionId:function(){return this.options.questionId},getSectionId:function(){return this.options.sectionId},getQuestionCode:function(){return this.options.questionCode},getDescription1:function(){return this.options.description1},getDescription2:function(){return this.options.description2},getParentId:function(){return this.options.parentId},getQuestionTypeId:function(){return this.options.questionTypeId},getEnableOther:function(){return this.options.enableOther},getNumberRange:function(){return this.options.numberRange},getDateRange:function(){return this.options.dateRange}});var QuestionType=new Class({Implements:[Option,Fields],fields:{primaryKey:{name:"questionTypeId",dataType:"INTEGER",isPrimaryKey:true},questionTypeName:{name:"questionTypeName",dataType:"TEXT"}},options:{questionTypeId:"",questionTypeName:"",},setQuestionTypeId:function(b){this.options.questionTypeId=b},setQuestionTypeName:function(b){this.options.questionTypeName=b},getQuestionTypeId:function(){return this.options.questionTypeId},getQuestionTypeName:function(){return this.options.questionTypeName}});var Answer=new Class({Implements:[Option,Fields],fields:{primaryKey:{name:"answerId",dataType:"INTEGER",isPrimaryKey:true},questionId:{name:"questionId",dataType:"INTEGER"},description1:{name:"description1",dataType:"TEXT"},description2:{name:"description2",dataType:"TEXT"},value:{name:"value",dataType:"INTEGER"},goToQuestionId:{name:"goToQuestionId",dataType:"INTEGER"}},options:{answerId:"",questionId:"",description1:"",description2:"",value:"",goToQuestionId:"",},setQuestionId:function(b){this.options.questionId=b},setAnswerId:function(b){this.options.answerId=b},setGoToQuestionId:function(b){this.options.goToQuestionId=b},setValue:function(b){this.options.value=b},setDescription1:function(b){this.options.description1=b},setDescription2:function(b){this.options.description2=b},getGoToQuestionId:function(){return this.options.goToQuestionId},getValue:function(){return this.options.value},getQuestionId:function(){return this.options.questionId},getAnswerId:function(){return this.options.answerId},});var ParticipantAnswer=new Class({Implements:[Options,Fields],fields:{primaryKey:{name:"participantAnswerId",dataType:"INTEGER",isPrimaryKey:true},interviewCode:{name:"interviewCode",dataType:"INTEGER"},participantCode:{name:"participantCode",dataType:"INTEGER"},answerId:{name:"answerId",dataType:"INTEGER"},questionId:{name:"questionId",dataType:"INTEGER"},description:{name:"description",dataType:"TEXT"}},options:{participantAnswerId:"",interviewCode:"",participantCode:"",answerId:"",questionId:"",description:"",},setParticipantAnswerId:function(b){this.options.participantAnserId=b},getParticipantAnswerId:function(){return this.options.participantAnserId},setInterviewCode:function(b){this.options.interviewCode=b},getInterviewCode:function(){return this.options.interviewCode},setParticipantCode:function(b){this.options.participantCode=b},getParticipantCode:function(){return this.options.participantCode},setAnswerId:function(b){this.options.answerId=b},getAnswerId:function(){return this.options.answerId},setQuestionId:function(b){this.options.questionId=b},getQuestionId:function(){return this.options.questionId},setDescription:function(b){this.options.description=b},getDescription:function(){return this.options.description}});var SurveysDao=new Class({Extends:SQLiteHelper,Implements:Surveys,options:{tableName:"Surveys",},jQuery:"SurveysDao",initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()},updateStatus:function(d,b){var c="UPDATE "+this.options.tableName+" SET status = ? WHERE surveyId = "+d;this.getDB().transaction(function(e){e.executeSql(c,[b],function(){console.log("update status done!")},function(f,g){console.log("update status fail "+g.message)})})},getAll:function(){var c="SELECT * FROM "+this.options.tableName;var b=[];this.options.db.transaction(function(d){d.executeSql(c,[],function(f,e){dataset=e.rows;for(var g=0;g<dataset.length;g++){console.log("Reading dataset..");var h=new Surveys();h.setSurveyId(dataset.item(g)["surveyId"]);h.setSurveyCode(dataset.item(g)["surveyCode"]);h.setDescription1(dataset.item(g)["description1"]);h.setDescription2(dataset.item(g)["description2"]);h.setStatus(dataset.item(g)["status"]);b.push(h)}})});return b},});var QuestionDao=new Class({Extends:SQLiteHelper,Implements:Question,options:{tableName:"Question",},jQuery:"QuestionDao",initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()},getAll:function(){var c="SELECT * FROM "+this.options.tableName;var b=[];this.options.db.transaction(function(d){d.executeSql(c,[],function(f,e){dataset=e.rows;console.log(dataset.length);for(var g=0;g<dataset.length;g++){console.log("Reading question dataset..");var h=new Question();h.setQuestionId(dataset.item(g)["questionId"]);h.setSurveyId(dataset.item(g)["surveyId"]);h.setQuestionCode(dataset.item(g)["questionCode"]);h.setQuestionName(dataset.item(g)["questionName"]);h.setText(dataset.item(g)["text"]);b.push(h)}})});return b},getBySurvey:function(d){var c="SELECT * FROM "+this.options.tableName+" WHERE sectionId = "+d;console.log(c);var b=[];this.options.db.transaction(function(e){e.executeSql(c,[],function(g,f){dataset=f.rows;console.log(dataset.length);for(var h=0;h<dataset.length;h++){console.log("Reading question dataset..");var j=new Question();j.setQuestionId(dataset.item(h)["questionId"]);j.setSectionId(dataset.item(h)["surveyId"]);j.setQuestionCode(dataset.item(h)["questionCode"]);j.setDescription1(dataset.item(h)["description1"]);j.setDescription2(dataset.item(h)["description2"]);j.setQuestionTypeId(dataset.item(h)["questionTypeId"]);b.push(j)}})});return b},});var SectionDao=new Class({Extends:SQLiteHelper,Implements:Section,options:{tableName:"Section",},jQuery:"SectionDao",initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()},});var QuestionTypeDao=new Class({Extends:SQLiteHelper,Implements:QuestionType,options:{tableName:"QuestionType"},jQuery:"QuestionTypeDao",initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()},getAll:function(){var c=this;var b=[];this.options.db.transaction(function(d){d.executeSql(c.getSelectAllStatement(),[],function(f,e){dataset=e.rows;for(var g=0;g<dataset.length;g++){var h=new QuestionType();h.setQuestionTypeId(dataset.item(g)["questionTypeId"]);h.setQuestionTypeName(dataset.item(g)["questionTypeName"]);b.push(h)}})});return b},findByPrimaryKey:function(d){var c=this;var b=[];this.options.db.transaction(function(e){e.executeSql(c.getFindByPrimaryKeyStatement(d),[],function(g,f){dataset=f.rows;for(var h=0;h<dataset.length;h++){console.log(dataset.item(h)["questionTypeId"]);var j=new QuestionType();j.setQuestionTypeId(dataset.item(h)["questionTypeId"]);j.setQuestionTypeName(dataset.item(h)["questionTypeName"]);b.push(j)}})});return b}});var ParticipantAnswerDao=new Class({Extends:SQLiteHelper,Implements:ParticipantAnswer,options:{tableName:"ParticipantAnswerDao",},initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()}});var AnswerDao=new Class({Extends:SQLiteHelper,Implements:Answer,options:{tableName:"Answer",},jQuery:"AnswerDao",initialize:function(b){if(typeof this.getDB()==="undefined"||this.getDB()===""){this.parent()}this.createTable()},getAll:function(){var c="SELECT * FROM "+this.options.tableName;var b=[];this.options.db.transaction(function(d){d.executeSql(c,[],function(f,e){dataset=e.rows;for(var g=0;g<dataset.length;g++){console.log("Reading dataset..");var h=new Answer();h.setQuestionId(dataset.item(g)["questionId"]);h.setAnswerId(dataset.item(g)["answerId"]);h.setDescription1(dataset.item(g)["description1"]);h.setDescription2(dataset.item(g)["description2"]);h.setValue(dataset.item(g)["value"]);h.setGoToQuestionId(dataset.item(g)["goToQuestionId"]);b.push(h)}})});return b},getByQuestion:function(d){var b="SELECT * FROM "+this.options.tableName+" WHERE questionId = "+d;var c=[];this.options.db.transaction(function(e){e.executeSql(b,[],function(g,f){dataset=f.rows;for(var h=0;h<dataset.length;h++){console.log("Reading answer dataset..");var j=new Answer();j.setQuestionId(dataset.item(h)["questionId"]);j.setAnswerId(dataset.item(h)["answerId"]);j.setDescription1(dataset.item(h)["description1"]);j.setDescription2(dataset.item(h)["description2"]);j.setValue(dataset.item(h)["value"]);j.setGoToQuestionId(dataset.item(h)["goToQuestionId"]);c.push(j)}})});return c},});var SampleTable=new Class({Extends:SQLiteHelper,options:{tableName:"Sample",},jQuery:"SampleTable",});var surveyDao=null,questionDao=null,answerDao=null,sectionDao=null,questionTypeDao=null,participantAnswerDao=null;var sampleJson={survey:[{SurveyID:"1",SurveyCode:"S01",Description1:"SMART Girl",Description2:"ស្មាតហ្គឺល",Logo:null,IntroductionText:"អ្នកអាចចំណាយ ពេលប្រហែលជា៦០នាទីសម្រាប់ចូលរួមក្នុងការសិក្សាស្រាវជ្រាវនេះ។ មានសំនួរមួយចំនួននឹង សួរពីរឿងផ្ទាល់ខ្លួនរបស់អ្នក។ អ្នកអាចបដិសេធមិនឆ្លើយនូវសំនួរណា ដែលអ្នកមិនចង់ឆ្លើយ។ យើងសុំឲ្យអ្នកឆ្លើយដោយស្មោះត",EndText:"សូមអរគុណសំរាប់ការចូលរួម។",AddedDate:"2013-04-21 17:16:39",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],section:[{SectionID:"1",SectionCode:"A",Description1:"Demographics",Description2:"លក្ខណៈប្រជាសាស្រ្ត",SurveyID:"1",AddedDate:"2013-04-21 17:21:28",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{SectionID:"2",SectionCode:"B",Description1:"Occupation and Socioeconomic Status",Description2:"ការងារ និងសុខមាលភាពសេដ្ឋកិច្ច",SurveyID:"1",AddedDate:"2013-04-21 17:23:58",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],questiontype:[{QuestionTypeID:"1",QuestionTypeName:"Text",AddedDate:"2013-04-21 16:09:30",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{QuestionTypeID:"2",QuestionTypeName:"Number",AddedDate:"2013-04-21 16:39:22",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{QuestionTypeID:"3",QuestionTypeName:"Date",AddedDate:"2013-04-21 16:40:39",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{QuestionTypeID:"4",QuestionTypeName:"Single",AddedDate:"2013-04-21 16:44:30",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{QuestionTypeID:"5",QuestionTypeName:"Multiple",AddedDate:"2013-04-21 16:44:49",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],question:[{QuestionID:"1",QuestionCode:"A1",Description1:"How old are you?",Description2:"តើអ្នកមានអាយុប៉ុន្មានឆ្នាំ",ParentID:null,SectionID:"1",QuestionTypeID:"2",Image:null,OrderNo:"1",AllowNull:"0",EnableOther:"0",NumberRangeFrom:null,NumberRangeTo:null,DateRangeFrom:null,DateRangeTo:null,AddedDate:"2013-04-21 17:29:56",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{QuestionID:"2",QuestionCode:"A2",Description1:"Are you married?",Description2:"តើអ្នករៀបការហើយឬនៅ?",ParentID:null,SectionID:"1",QuestionTypeID:"4",Image:null,OrderNo:"2",AllowNull:"0",EnableOther:"0",NumberRangeFrom:null,NumberRangeTo:null,DateRangeFrom:null,DateRangeTo:null,AddedDate:"2013-04-21 17:32:04",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],answer:[{AnswerID:"2",QuestionID:"2",Description1:"Legally Married",Description2:"រៀបការតាមច្បាប់",Value:"1",GoToQuestionID:null,AddedDate:"2013-04-21 17:35:13",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{AnswerID:"3",QuestionID:"2",Description1:"Traditional Marriage",Description2:"រៀបការតាមប្រពៃណី",Value:"2",GoToQuestionID:null,AddedDate:"2013-04-21 17:35:53",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{AnswerID:"4",QuestionID:"2",Description1:"Living together but not in a legal or traditional marriage",Description2:"រស់នៅជាមួយគ្នាប៉ុន្តែមិនបានរៀបការតាមច្បាប់/រៀបការតាមប្រពៃណី",Value:"3",GoToQuestionID:null,AddedDate:"2013-04-21 17:37:27",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{AnswerID:"5",QuestionID:"2",Description1:"Single",Description2:"នៅលីវ (មិនធ្លាប់រៀបការ)",Value:"6",GoToQuestionID:null,AddedDate:"2013-04-21 17:41:01",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],language:[{LanguageID:"1",LanguageCode:"EN",LanguageName:"English",AddedDate:"2013-04-21 16:54:16",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{LanguageID:"2",LanguageCode:"KH",LanguageName:"Khmer",AddedDate:"2013-04-21 16:54:35",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}],province:[{ProvinceID:"1",ProvinceCode:"PP",ProvinceName:"Phnom Penh",AddedDate:"2013-04-21 16:57:22",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"2",ProvinceCode:"BB",ProvinceName:"Battambang",AddedDate:"2013-04-21 16:57:51",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"3",ProvinceCode:"SR",ProvinceName:"Siem Reap",AddedDate:"2013-04-21 16:58:07",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"4",ProvinceCode:"KC",ProvinceName:"Kampong Cham",AddedDate:"2013-04-21 16:58:55",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"5",ProvinceCode:"PL",ProvinceName:"Paillin",AddedDate:"2013-04-21 17:02:40",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"6",ProvinceCode:"BM",ProvinceName:"Banteay Meanchey",AddedDate:"2013-04-21 17:02:51",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"7",ProvinceCode:"KS",ProvinceName:"Kampong Speu",AddedDate:"2013-04-21 17:03:05",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"8",ProvinceCode:"KD",ProvinceName:"Kandal",AddedDate:"2013-04-21 17:03:18",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"9",ProvinceCode:"SN",ProvinceName:"Sihanouk",AddedDate:"2013-04-21 17:03:26",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"},{ProvinceID:"10",ProvinceCode:"KN",ProvinceName:"Kampong Chhnang",AddedDate:"2013-04-21 17:03:34",AddedBy:"langda",EditedDate:null,EditedBy:null,Status:"1"}]};var AnswerAdapter=new Class({Implements:Options,options:{questionType:"",},answers:[],initialize:function(b,c){this.answers=c;this.setOptions(b)},mergeTemplate:function(){for(var c=0;c<this.answers.length;c++){var f=this.answers[c];switch(Number(this.options.questionType)){case 4:var d=new SingleAnswer(f.options);d.mergeTemplate();break;case 5:var b=new MultipleAnswer(f.options);b.mergeTemplate();break;case 1:var e=new InputTextAnswer(f.options);e.mergeTemplate();break;case 2:var e=new InputTextAnswer(f.options);e.mergeTemplate();break;case 3:break;default:console.log("unknow answer type")}}},mergeAnswerTemplate:function(){console.log("merge Answer template")}});var GroupQuestionAdapter=new Class({Implements:[QuestionAdapter,AnswerAdapter],initialize:function(b){this.data=this.convert()},mergeGroupTemplate:function(){for(q=0;q<this.data.questions.length;q++){console.log((q+1)+". "+this.data.questions[q].label);for(a=0;a<this.data.questions[q].answers.length;a++){console.log(this.data.questions[q].answers[a])}}},convert:function(){var b=new Object();b.label="How about program";b.questions=new Array();var c=new Object();c.label="How do you know the program?";c.answers=new Array();c.answers.push("Radio");c.answers.push("TV");c.answers.push("Website");c.answers.push("Newspager");b.questions.push(c);var c=new Object();c.label="When do the program start?";c.answers=new Array();c.answers.push("Monday");c.answers.push("Tueday");c.answers.push("Wensday");c.answers.push("Thurday");b.questions.push(c);return b}});var InputTextAnswer=new Class({answers:[],initialize:function(b){this.answers=b},mergeTemplate:function(){$("#textTemplate").tmpl(this.answers).appendTo($(".answer-block"))}});var MultipleAnswer=new Class({answer:[],initialize:function(b){this.answer=b},mergeTemplate:function(){$("#multipleTemplate").tmpl(this.answer).appendTo($(".answer-block"))}});var QuestionAdapter=new Class({question:null,initialize:function(b){this.question=b},mergeTemplate:function(c,d){var b=$("#questionTemplate").tmpl(this.question.options);$("#content").prepend(b);if(c!=undefined&&d!=undefined){b.bind(c,function(){d($(this).find(".answer-block"))})}},mergeQuestionTemplate:function(){console.log("merge question template")}});var SingleAnswer=new Class({answers:[],initialize:function(b){this.answers=b},mergeTemplate:function(){$("#singleTemplate").tmpl(this.answers).appendTo($(".answer-block"))}});var BaseJSNetwork=new Class({initialize:function(b){},getRequest:function(e,c,b,d){console.log(e);$.ajax({type:"GET",url:e,dataType:"json",success:function(g,h,f){b(g)},error:function(f,h,g){console.log(h+"| "+g);d(f,h,g)}})},postRequest:function(e,c,b,d){$.post(e,c,function(f,h,g){b(f,h,g)},"json").error(function(f,h,g){d(f,h,g)})},deleteRequest:function(d,b,c){$.ajax({type:"DELETE",url:d,dataType:"json",success:function(f,g,e){b(f)},error:function(e,g,f){c(e,g,f)}})}});var CASIAPIRequests=new Class({Extends:BaseJSNetwork,Implements:JSONParser,initailize:function(b){this.parent();this.baseUrl="http://cenat.gov.kh:8090/CASIMS/index.php/home/getjsondata"},pushAnswer:function(c,b,d){this.postRequest(this.baseUrl,c,b,d)},downloadSurvey:function(){requestData=[];var b=this;this.getRequest("http://cenat.gov.kh:8090/CASIMS/index.php/home/getjsondata",requestData,function(c){b.insertDB(c)},function(){b.downloadSurveyFail()})},insertDB:function(b){console.log(">>>>>"+b);this.parseJson(b)},downloadSurveyFail:function(){console.log("download survey fail. reading from static sample json");this.parseJson(sampelJson)},parseJson:function(d){var i=d.survey,h=d.section,e=d.questiontype,c=d.question,f=d.answer,g=d.participantanswer,b=d.province;this.parseSurvey(i);this.parseSection(h);this.parseQuestionType(e);this.parseQuestion(c);this.parseAnswer(f);this.parseParticipantAnswer(g);this.parseProvince(b)}});var JSONParser=new Class({parseSurvey:function(e){for(var d=0;d<e.length;d++){var c=new Surveys();var b=e[d];c.setSurveyId(b.SurveyID);c.setSurveyCode(b.SurveyCode);c.setDescription1(b.Description1);c.setDescription2(b.Description2);surveyDao.persist(c)}},parseSection:function(e){for(var c=0;c<e.length;c++){var d=new Section();var b=e[c];d.setSectionId(b.SectionID);d.setSurveyId(b.SurveyID);d.setSectionCode(b.SectionCode);d.setDescription1(b.Description1);d.setDescription2(b.Description2);sectionDao.persist(d)}},parseQuestionType:function(e){for(var c=0;c<e.length;c++){var b=new QuestionType();var d=e[c];b.setQuestionTypeId(d.QuestionTypeID);b.setQuestionTypeName(d.QuestionTypeName);questionTypeDao.persist(b)}},parseQuestion:function(d){for(var c=0;c<d.length;c++){var b=new Question();var e=d[c];b.setQuestionId(e.QuestionID);b.setSectionId(e.SectionID);b.setQuestionCode(e.QuestionCode);b.setAllowNull(e.AllowNull);b.setDescription1(e.Description1);b.setDescription2(e.Description2);b.setParentId(e.ParentID);b.setQuestionTypeId(e.QuestionTypeID);b.setEnableOther(e.EnableOther);b.setNumberRange(e.NumberRangeFrom+"-"+e.NumberRangeTo);b.setDateRange(e.DateRangeFrom+"-"+e.DateRangeTo);b.setImage(e.Image);questionDao.persist(b)}},parseAnswer:function(e){for(var c=0;c<e.length;c++){var d=new Answer();var b=e[c];d.setAnswerId(b.AnswerID);d.setQuestionId(b.QuestionID);d.setDescription1(b.Description1);d.setDescription2(b.Description2);d.setValue(b.Value);d.setGoToQuestionId(b.GoToQuestionID);answerDao.persist(d)}},parseProvince:function(b){},parseParticipantAnswer:function(b){},});